# Teams Account Manager 実行計画書

## 1. 実装する機能の一覧

### フェーズ1：基盤構築（現在）
1. プロジェクト構造の作成
2. 認証機能の実装（MSAL.NET）
3. 基本的なUI構築（WPF + Material Design）
4. 多言語対応の基盤整備

### フェーズ2：コア機能実装
1. Microsoft Graph API連携
2. ユーザー情報取得機能
3. DataGridでのユーザー一覧表示
4. 検索・フィルタリング機能

### フェーズ3：データ入出力機能
1. Excelエクスポート機能（EPPlus）
2. CSVエクスポート機能（CsvHelper）
3. Excelインポート機能
4. CSVインポート機能
5. データ検証とエラーハンドリング

### フェーズ4：編集・更新機能
1. インライン編集機能
2. 一括編集機能
3. 変更差分検出
4. Microsoft 365への更新処理
5. 操作履歴機能

### フェーズ5：品質向上
1. エラーハンドリングの強化
2. ログ機能の実装
3. パフォーマンス最適化
4. UIの洗練

## 2. 技術的な実装方針

### 2.1 アーキテクチャ
- **パターン**: MVVM (Model-View-ViewModel)
- **DI コンテナ**: Microsoft.Extensions.DependencyInjection
- **データバインディング**: WPF標準 + CommunityToolkit.Mvvm

### 2.2 主要技術スタック
```xml
<Project Sdk="Microsoft.NET.Sdk">
  <PropertyGroup>
    <OutputType>WinExe</OutputType>
    <TargetFramework>net8.0-windows</TargetFramework>
    <UseWPF>true</UseWPF>
  </PropertyGroup>
  
  <ItemGroup>
    <!-- 認証 -->
    <PackageReference Include="Microsoft.Identity.Client" Version="4.61.3" />
    
    <!-- Microsoft Graph -->
    <PackageReference Include="Microsoft.Graph" Version="5.56.0" />
    
    <!-- UI -->
    <PackageReference Include="MaterialDesignThemes" Version="5.0.0" />
    
    <!-- MVVM -->
    <PackageReference Include="CommunityToolkit.Mvvm" Version="8.2.2" />
    
    <!-- Excel/CSV -->
    <PackageReference Include="EPPlus" Version="7.0.10" />
    <PackageReference Include="CsvHelper" Version="31.0.2" />
    
    <!-- DI -->
    <PackageReference Include="Microsoft.Extensions.DependencyInjection" Version="8.0.0" />
    <PackageReference Include="Microsoft.Extensions.Configuration.Json" Version="8.0.0" />
  </ItemGroup>
</Project>
```

### 2.3 フォルダ構造
- **Models**: データモデル、エンティティ
- **ViewModels**: ビューモデル（画面ロジック）
- **Views**: XAMLビュー（画面定義）
- **Services**: ビジネスロジック、外部API連携
- **Helpers**: ユーティリティクラス
- **Resources**: リソースファイル（多言語、スタイル）

### 2.4 認証フロー
1. アプリケーション起動
2. Azure AD アプリケーション設定読み込み
3. MSAL.NETによる認証画面表示
4. ユーザーがMicrosoft 365アカウントでログイン
5. アクセストークン取得・保存
6. Graph API呼び出し可能状態

### 2.5 データフロー
```
[Microsoft 365] 
    ↓ Graph API
[AuthenticationService] → [GraphApiService]
    ↓ User Data
[UserListViewModel] ← [User Model]
    ↓ Binding
[UserListView (DataGrid)]
    ↓ Export/Import
[ExcelService / CsvService]
    ↓
[File System]
```

## 3. テスト計画

### 3.1 単体テスト
- ViewModelのロジックテスト
- Serviceクラスのテスト
- データ検証ロジックのテスト

### 3.2 統合テスト
- 認証フローの確認
- Graph API連携の確認
- ファイル入出力の確認

### 3.3 手動テスト項目
1. **認証テスト**
   - 管理者アカウントでのログイン
   - 一般ユーザーでのログイン（エラー確認）
   - トークン期限切れ時の再認証

2. **データ取得テスト**
   - 100件、1000件、10000件のユーザー取得
   - フィルタリング機能
   - ページネーション

3. **エクスポート/インポートテスト**
   - 各形式でのエクスポート確認
   - 日本語データの文字化け確認
   - 大量データの処理時間測定

4. **更新テスト**
   - 単一ユーザーの更新
   - 一括更新（10件、100件）
   - エラー時のロールバック確認

5. **多言語テスト**
   - 各言語での表示確認
   - 言語切り替え動作
   - エラーメッセージの翻訳確認

## 4. 成果物一覧

### 4.1 実行ファイル
- TeamsAccountManager.exe（単一実行ファイル）

### 4.2 設定ファイル
- appsettings.json（アプリケーション設定）
- appsettings.Development.json（開発環境設定）

### 4.3 ドキュメント
- 要件定義書
- 実行計画書（本書）
- 進捗チェックシート
- 操作マニュアル（フェーズ5で作成）

### 4.4 サンプルファイル
- sample_users.csv（インポート用サンプル）
- sample_users.xlsx（インポート用サンプル）

## 5. リスクと対策

### 5.1 技術的リスク
| リスク | 影響度 | 対策 |
|--------|--------|------|
| Graph APIレート制限 | 高 | リトライ機能実装、バッチ処理最適化 |
| 大量データ処理時のメモリ不足 | 中 | ページング処理、非同期処理 |
| 認証トークンの管理 | 高 | Windows資格情報マネージャー使用 |

### 5.2 運用リスク
| リスク | 影響度 | 対策 |
|--------|--------|------|
| 権限不足によるエラー | 中 | 事前の権限チェック機能 |
| ネットワーク断による処理中断 | 中 | 再試行機能、途中保存機能 |

## 改訂履歴

| 日付 | バージョン | 変更内容 |
|------|------------|----------|
| 2025-08-02 | 1.0 | 初版作成 |