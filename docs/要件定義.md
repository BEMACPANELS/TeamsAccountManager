# Teams Account Manager 要件定義書

## 1. プロジェクト概要

### 1.1 システム名
Teams Account Manager

### 1.2 システムの目的
Microsoft 365のユーザー管理者・グローバル管理者向けに、Microsoft Teamsのアカウント情報を効率的に管理するためのWindowsデスクトップアプリケーションを提供する。

### 1.3 主な機能
- Microsoft Graph APIを使用したユーザー情報の取得
- Excel/CSV形式でのエクスポート・インポート
- ユーザー情報の一括編集・更新
- 多言語対応（日本語・ベトナム語・英語）

## 2. 機能要件

### 2.1 認証機能
- **認証方式**: Microsoft 365アカウントによるOAuth 2.0認証（MSAL.NET使用）
- **必要な権限**:
  - User.Read.All - すべてのユーザーの基本プロファイルを読み取る
  - User.ReadWrite.All - すべてのユーザーのプロファイルを読み書きする
  - Directory.Read.All - ディレクトリデータを読み取る
- **トークン管理**: 自動更新機能を実装

### 2.2 ユーザー情報取得機能
Microsoft Graph APIから以下のプロパティを取得：

#### デフォルトプロパティ
- id - ユーザーの一意識別子
- businessPhones - 会社の電話番号
- displayName - 表示名
- givenName - 名
- jobTitle - 役職
- mail - メールアドレス
- mobilePhone - 携帯電話番号
- officeLocation - オフィスの場所
- preferredLanguage - 優先言語
- surname - 姓
- userPrincipalName - ユーザープリンシパル名

#### 拡張プロパティ（$selectで取得）
- department - 部署
- companyName - 会社名
- country - 国
- city - 市区町村
- postalCode - 郵便番号
- state - 都道府県
- usageLocation - 使用場所
- accountEnabled - アカウント有効/無効

### 2.3 エクスポート機能
- **対応形式**:
  - Excel形式（.xlsx）- EPPlusライブラリ使用
  - CSV形式（UTF-8 with BOM）- CsvHelperライブラリ使用
- **エクスポート内容**: 取得したすべてのユーザープロパティ
- **フィルタリング**: 部署、役職、アカウント状態などでフィルタリング可能
- **カラム選択**: エクスポートするカラムを選択可能

### 2.4 インポート機能
- **対応形式**:
  - Excel形式（.xlsx）
  - CSV形式（UTF-8、Shift-JIS自動判定）
- **データ検証**:
  - 必須フィールドチェック（userPrincipalName、displayName）
  - メールアドレス形式検証
  - UPN重複チェック
  - データ型検証
- **プレビュー機能**: インポート前に変更内容を確認
- **エラーハンドリング**: エラー行の特定と詳細表示

### 2.5 編集・更新機能
- **編集方法**:
  - DataGrid上での直接編集
  - 一括置換機能（例：部署名の一括変更）
  - コピー＆ペースト対応
- **更新処理**:
  - 変更差分の自動検出
  - バッチ処理による効率的な更新
  - 進捗表示
- **履歴管理**: 変更履歴の記録と表示

### 2.6 多言語対応
- **対応言語**:
  - 日本語（ja-JP）- デフォルト
  - ベトナム語（vi-VN）
  - 英語（en-US）
- **実装方法**: WPFリソースディクショナリによる動的切り替え
- **保存**: ユーザー設定として言語選択を保存

## 3. 非機能要件

### 3.1 性能要件
- ユーザー一覧取得: 1,000ユーザーを30秒以内
- エクスポート処理: 10,000ユーザーを1分以内
- インポート処理: 1,000ユーザーを2分以内

### 3.2 セキュリティ要件
- 認証トークンの安全な保管（Windows資格情報マネージャー使用）
- 通信の暗号化（HTTPS必須）
- 監査ログの記録

### 3.3 操作性要件
- 直感的なUI（Material Design採用）
- キーボードショートカット対応
- ドラッグ＆ドロップ対応（ファイルインポート）

### 3.4 システム要件
- **OS**: Windows 10/11（64bit）
- **ランタイム**: .NET 8 Runtime
- **メモリ**: 4GB以上推奨
- **ディスク**: 100MB以上の空き容量

## 4. 開発効率化ツール統合

### 4.1 Microsoft Learn MCP Server
- **用途**: Graph APIドキュメントの参照
- **エンドポイント**: https://learn.microsoft.com/api/mcp
- **活用方法**:
  - APIリファレンスの確認
  - エラーメッセージの調査
  - ベストプラクティスの参照

### 4.2 MCP Server Serena
- **用途**: 開発効率化
- **機能**:
  - コード生成支援
  - ボイラープレートコードの削減
  - エラーハンドリングパターンの提供

## 5. 制約事項

### 5.1 技術的制約
- Microsoft Graph APIのレート制限（1アプリケーションあたり毎分120リクエスト）
- 一度に取得できるユーザー数の上限（999ユーザー/リクエスト）
- Graph APIのプロパティ制限（一部プロパティは特定の権限が必要）

### 5.2 運用上の制約
- 管理者権限を持つアカウントでのみ使用可能
- オフライン環境では使用不可（API通信が必須）

## 6. 今後の拡張予定

### 6.1 フェーズ2（将来実装）
- グループ管理機能
- ライセンス管理機能
- 定期実行・スケジューリング機能
- PowerShellスクリプト生成機能

### 6.2 フェーズ3（検討中）
- Teams固有の設定管理
- OneDrive容量管理
- Exchange設定管理

## 改訂履歴

| 日付 | バージョン | 変更内容 | 作成者 |
|------|------------|----------|--------|
| 2025-08-02 | 1.0 | 初版作成 | Teams Account Manager開発チーム |