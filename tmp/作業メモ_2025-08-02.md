# Teams Account Manager 作業メモ

## 2025年8月2日

### 完了した作業

#### プロジェクト構造作成
- [x] プロジェクトディレクトリ構造の作成
- [x] ドキュメント作成（要件定義、実行計画書、進捗チェックシート）
- [x] .csprojファイル作成（.NET 8 + WPF + 必要なNuGetパッケージ）

#### 基本ファイル作成
- [x] App.xaml/App.xaml.cs（DIコンテナ設定、多言語対応）
- [x] MainWindow.xaml/MainWindow.xaml.cs（メインUI、言語切替）
- [x] User.cs モデル（Microsoft Graph API プロパティ対応）
- [x] AppSettings.cs（設定モデル）
- [x] MainViewModel.cs（MVVM基本実装）

#### サービスクラス作成
- [x] AuthenticationService.cs（MSAL.NET認証サービス）
- [x] GraphApiService.cs（Microsoft Graph API連携）
- [x] McpService.cs（MCP統合サービス）

#### MCP設定
- [x] uvパッケージマネージャーインストール
- [x] Serena MCP Serverインストール（uvx使用）
- [x] .claude/instructions.md作成（MCP活用指針）
- [x] appsettings.json/appsettings.Development.json（MCP設定含む）
- [x] .serena/project.yml作成（プロジェクト固有設定）

### 現在の課題

#### Serena MCP Server起動エラー
- **問題**: `.serena/project.yml`の設定形式でエラー
- **エラー内容**: `KeyError: 'language'`
- **対応**: 設定ファイルの構造を修正済み

#### 次の作業予定
1. Serena MCP Server正常起動確認
2. Claude CodeとMCP Serverの接続設定
3. 残りのサービスクラス実装（ExcelService、CsvService）
4. 多言語リソースファイル作成
5. ViewとViewModelの実装

### 技術情報

#### 使用技術スタック
- .NET 8 + WPF
- MSAL.NET（認証）
- Microsoft Graph SDK
- EPPlus（Excel）
- CsvHelper（CSV）
- MaterialDesignThemes（UI）
- CommunityToolkit.Mvvm（MVVM）

#### MCP統合
- Microsoft Learn MCP Server: Graph APIドキュメント参照
- Serena MCP Server: コード生成・開発効率化

#### Azure AD設定（要設定）
- TenantId: 未設定
- ClientId: 未設定  
- 必要な権限: User.Read.All, User.ReadWrite.All, Directory.Read.All

### MCP設定完了（追記）

#### Serena MCP Server
- [x] uvパッケージマネージャーインストール完了
- [x] Serena MCP Serverインストール完了（uvx使用）
- [x] プロジェクト設定ファイル（`.serena/project.yml`）作成
- [x] 設定エラー修正（language フィールド構造修正）
- [x] サーバー起動確認完了（STDIOモード）

#### Claude Code MCP統合設定
- [x] `.mcp.json`設定ファイル作成（ユーザースコープ）
- [x] Filesystem MCPサーバーインストール（`@modelcontextprotocol/server-filesystem`）
- [x] Serena MCPサーバー設定追加
- [x] Microsoft Learn Service作成（直接API連携）

#### MCP設定詳細
```json
{
  "mcpServers": {
    "filesystem": {
      "command": "npx",
      "args": ["@modelcontextprotocol/server-filesystem", "C:\\Users\\neozi"]
    },
    "serena": {
      "command": "uvx",
      "args": ["--from", "git+https://github.com/oraios/serena", "serena", "start-mcp-server", "--project", "C:\\Users\\neozi\\Teams Account Manager", "--transport", "stdio"]
    }
  }
}
```

#### 追加作成ファイル
- `C:\Users\neozi\.mcp.json` - Claude Code MCP設定
- `MsLearnService.cs` - Microsoft Learn API直接連携サービス

### 現在のMCP活用体制
1. **Filesystem MCP**: プロジェクトファイル操作
2. **Serena MCP**: コード生成・開発効率化  
3. **Microsoft Learn Service**: Graph API正確情報取得

### メモ

- プロジェクト構造は共通ガイドラインに準拠
- 多言語対応（日本語、ベトナム語、英語）の基盤完成
- MCPサーバー統合でGraph APIフィールド名の正確性確保
- 開発効率化のためのSerena統合完了
- Claude Code `/mcp` コマンドでMCPサーバー利用可能

### Serena MCP Server 状況（追記 2025-08-02）

#### 接続成功
- Serena MCPサーバーが正常に接続（`/mcp`コマンドで確認）
- `.serena/project.yml`設定ファイル作成済み
- プロジェクト設定：
  - 言語: C# (WPF)
  - フレームワーク: .NET 8
  - Microsoft Graph API支援機能有効
  - MVVM パターン支援機能有効
  - 多言語対応支援機能有効

#### 既知の問題
- C#言語サーバー（Microsoft.CodeAnalysis.LanguageServer）のダウンロードエラー
- エラー内容: ファイルパスが見つからない（Windowsの長いパス名制限の可能性）
- 影響: 
  - Serenaの一部機能（コード解析など）が制限される
  - プロジェクトインデックス作成ができない
  - MCPツール経由でのSerena機能が使用不可
- 回避策: 
  - 基本的なファイル操作は通常のClaude Codeツールで実施
  - コード生成はテンプレートを手動で利用